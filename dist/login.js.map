{"version":3,"sources":["../src/login.js"],"sourcesContent":["const arg = require('arg');\nconst inquirer = require('inquirer');\nconst { getAuthConfig, updateAuthConfig } =  require('./lib/config');\nconst {\n  info,\n  success\n} = require('./lib/log');\n\nfunction parseArgumentsIntoOptions(rawArgs) {\n  //https://www.npmjs.com/package/arg\n  const args = arg(\n    {\n      '--token': String,\n      '-c': Boolean,\n      // Aliases\n    },\n    {\n      argv: rawArgs.slice(2),\n    }\n  );\n  return {\n    token: args['--token'] || false,\n    t: args['-t'] || false,\n  };\n}\n\nasync function promptForMissingOptions(options) {\n  const questions = [];\n  if( 'string' !== typeof options.token ) {\n    questions.push({\n      type: 'prompt',\n      name: 'token',\n      message: 'Plugin Machine API token. https://pluginmachine.app/dashboard/api',\n      default: '',\n    });\n\n  }\n  if( questions.length ) {\n    const answers = await inquirer.prompt(questions);\n    return Object.assign(options, answers);\n  }\n  return options;\n}\n\n/**\n * Hander for `plugin-machine login ` command\n */\nexport async function doLogin(token) {\n  const config = updateAuthConfig({token});\n  success(`Logged in with token: ${token}`);\n}\n\n/**\n * Hander for `plugin-machine login {command}` commands\n */\nexport async function cli(args) {\n  let options = parseArgumentsIntoOptions(args);\n  if( options.c ) {\n    const config = getAuthConfig();\n    info( config );\n    return;\n  }\n  options = await promptForMissingOptions(options);\n  doLogin(options.token);\n}\n\n// ...\n"],"names":["doLogin","cli","arg","require","inquirer","getAuthConfig","updateAuthConfig","info","success","parseArgumentsIntoOptions","rawArgs","args","String","Boolean","argv","slice","token","t","promptForMissingOptions","options","questions","push","type","name","message","default","length","answers","prompt","Object","assign","config","c"],"mappings":";;;;QA+CsBA,OAAO,GAAPA,OAAO;QAQPC,GAAG,GAAHA,GAAG;AAvDzB,KAAK,CAACC,GAAG,GAAGC,OAAO,CAAC,CAAK;AACzB,KAAK,CAACC,QAAQ,GAAGD,OAAO,CAAC,CAAU;AACnC,KAAK,CAAC,CAAC,CAACE,aAAa,GAAEC,gBAAgB,EAAC,CAAC,GAAIH,OAAO,CAAC,CAAc;AACnE,KAAK,CAAC,CAAC,CACLI,IAAI,GACJC,OAAO,EACT,CAAC,GAAGL,OAAO,CAAC,CAAW;SAEdM,yBAAyB,CAACC,OAAO,EAAE,CAAC;IAC3C,EAAmC,AAAnC,iCAAmC;IACnC,KAAK,CAACC,IAAI,GAAGT,GAAG,CACd,CAAC;QACC,CAAS,UAAEU,MAAM;QACjB,CAAI,KAAEC,OAAO;IAEf,CAAC,EACD,CAAC;QACCC,IAAI,EAAEJ,OAAO,CAACK,KAAK,CAAC,CAAC;IACvB,CAAC;IAEH,MAAM,CAAC,CAAC;QACNC,KAAK,EAAEL,IAAI,CAAC,CAAS,aAAK,KAAK;QAC/BM,CAAC,EAAEN,IAAI,CAAC,CAAI,QAAK,KAAK;IACxB,CAAC;AACH,CAAC;eAEcO,uBAAuB,CAACC,OAAO,EAAE,CAAC;IAC/C,KAAK,CAACC,SAAS,GAAG,CAAC,CAAC;IACpB,EAAE,EAAE,CAAQ,YAAK,MAAM,CAACD,OAAO,CAACH,KAAK,EAAG,CAAC;QACvCI,SAAS,CAACC,IAAI,CAAC,CAAC;YACdC,IAAI,EAAE,CAAQ;YACdC,IAAI,EAAE,CAAO;YACbC,OAAO,EAAE,CAAmE;YAC5EC,OAAO,EAAE,CAAE;QACb,CAAC;IAEH,CAAC;IACD,EAAE,EAAEL,SAAS,CAACM,MAAM,EAAG,CAAC;QACtB,KAAK,CAACC,OAAO,GAAG,KAAK,CAACvB,QAAQ,CAACwB,MAAM,CAACR,SAAS;QAC/C,MAAM,CAACS,MAAM,CAACC,MAAM,CAACX,OAAO,EAAEQ,OAAO;IACvC,CAAC;IACD,MAAM,CAACR,OAAO;AAChB,CAAC;eAKqBnB,OAAO,CAACgB,KAAK,EAAE,CAAC;IACpC,KAAK,CAACe,MAAM,GAAGzB,gBAAgB,CAAC,CAACU;QAAAA,KAAK;IAAA,CAAC;IACvCR,OAAO,EAAE,sBAAsB,EAAEQ,KAAK;AACxC,CAAC;eAKqBf,GAAG,CAACU,IAAI,EAAE,CAAC;IAC/B,GAAG,CAACQ,OAAO,GAAGV,yBAAyB,CAACE,IAAI;IAC5C,EAAE,EAAEQ,OAAO,CAACa,CAAC,EAAG,CAAC;QACf,KAAK,CAACD,MAAM,GAAG1B,aAAa;QAC5BE,IAAI,CAAEwB,MAAM;QACZ,MAAM;IACR,CAAC;IACDZ,OAAO,GAAG,KAAK,CAACD,uBAAuB,CAACC,OAAO;IAC/CnB,OAAO,CAACmB,OAAO,CAACH,KAAK;AACvB,CAAC,AAED,CAAM,AAAN,EAAM,AAAN,IAAM"}