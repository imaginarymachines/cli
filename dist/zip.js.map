{"version":3,"sources":["../src/zip.js"],"sourcesContent":["\nexport async function makeZip(pluginDir,pluginMachineJson) {\n  function isDir(path) {\n      try {\n          var stat = fs.lstatSync(path);\n          return stat.isDirectory();\n      } catch (e) {\n          // lstatSync throws an error if path doesn't exist\n          return false;\n      }\n  }\n\n\n  const fs = require(\"fs\");\n  const archiver = require(\"archiver\");\n  const {slug,buildIncludes} = pluginMachineJson;\n\n  const output = fs.createWriteStream(`${slug}.zip`);\n  const archive = archiver(\"zip\");\n\n  console.log(\"Zipping!\");\n  output.on(\"close\", function () {\n    console.log(\"Zipped!\");\n    console.log(archive.pointer() + \" total bytes\");\n  });\n\n  archive.on(\"error\", function (err) {\n    throw err;\n  });\n\n  archive.pipe(output);\n\n  buildIncludes.forEach((name) => {\n      if (fs.existsSync(`${pluginDir}/${name}`)) {\n        if( isDir (name) ) {\n          archive.directory(`${name}/`, name);\n        }else{\n          archive.append(fs.createReadStream(`${pluginDir}/${name}`), {\n            name,\n          });\n        }\n      }\n\n  });\n\n\n  archive.finalize();\n}\n"],"names":["makeZip","pluginDir","pluginMachineJson","isDir","path","stat","fs","lstatSync","isDirectory","e","require","archiver","slug","buildIncludes","output","createWriteStream","archive","console","log","on","pointer","err","pipe","forEach","name","existsSync","directory","append","createReadStream","finalize"],"mappings":";;;;QACsBA,OAAO,GAAPA,OAAO;eAAPA,OAAO,CAACC,SAAS,EAACC,iBAAiB,EAAE,CAAC;aACjDC,KAAK,CAACC,IAAI,EAAE,CAAC;QAClB,GAAG,CAAC,CAAC;YACD,GAAG,CAACC,IAAI,GAAGC,EAAE,CAACC,SAAS,CAACH,IAAI;YAC5B,MAAM,CAACC,IAAI,CAACG,WAAW;QAC3B,CAAC,CAAC,KAAK,EAAEC,CAAC,EAAE,CAAC;YACT,EAAkD,AAAlD,gDAAkD;YAClD,MAAM,CAAC,KAAK;QAChB,CAAC;IACL,CAAC;IAGD,KAAK,CAACH,EAAE,GAAGI,OAAO,CAAC,CAAI;IACvB,KAAK,CAACC,QAAQ,GAAGD,OAAO,CAAC,CAAU;IACnC,KAAK,CAAC,CAACE,CAAAA,IAAI,GAACC,aAAa,EAAA,CAAC,GAAGX,iBAAiB;IAE9C,KAAK,CAACY,MAAM,GAAGR,EAAE,CAACS,iBAAiB,IAAIH,IAAI,CAAC,IAAI;IAChD,KAAK,CAACI,OAAO,GAAGL,QAAQ,CAAC,CAAK;IAE9BM,OAAO,CAACC,GAAG,CAAC,CAAU;IACtBJ,MAAM,CAACK,EAAE,CAAC,CAAO,QAAE,QAAQ,GAAI,CAAC;QAC9BF,OAAO,CAACC,GAAG,CAAC,CAAS;QACrBD,OAAO,CAACC,GAAG,CAACF,OAAO,CAACI,OAAO,KAAK,CAAc;IAChD,CAAC;IAEDJ,OAAO,CAACG,EAAE,CAAC,CAAO,QAAE,QAAQ,CAAEE,GAAG,EAAE,CAAC;QAClC,KAAK,CAACA,GAAG;IACX,CAAC;IAEDL,OAAO,CAACM,IAAI,CAACR,MAAM;IAEnBD,aAAa,CAACU,OAAO,EAAEC,IAAI,GAAK,CAAC;QAC7B,EAAE,EAAElB,EAAE,CAACmB,UAAU,IAAIxB,SAAS,CAAC,CAAC,EAAEuB,IAAI,KAAK,CAAC;YAC1C,EAAE,EAAErB,KAAK,CAAEqB,IAAI,GAAI,CAAC;gBAClBR,OAAO,CAACU,SAAS,IAAIF,IAAI,CAAC,CAAC,GAAGA,IAAI;YACpC,CAAC,MAAI,CAAC;gBACJR,OAAO,CAACW,MAAM,CAACrB,EAAE,CAACsB,gBAAgB,IAAI3B,SAAS,CAAC,CAAC,EAAEuB,IAAI,KAAK,CAAC;oBAC3DA,IAAI;gBACN,CAAC;YACH,CAAC;QACH,CAAC;IAEL,CAAC;IAGDR,OAAO,CAACa,QAAQ;AAClB,CAAC"}