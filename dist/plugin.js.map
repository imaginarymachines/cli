{"version":3,"sources":["../src/plugin.js"],"sourcesContent":["const arg = require('arg');\nconst inquirer = require('inquirer');\nconst { getAuthToken, getPluginDir, getPluginMachineJson,appUrl,apiUrl } = require( './lib/config');\n\nconst {\n  error,\n  important,\n  info,\n} = require('./lib/log');\n\n/**\n * Plugin Machine API client\n */\nexport const pluginMachineApi = async (token) => {\n  const FormData = require('form-data');\n\n  const fetch = require('isomorphic-fetch');\n  const fs = require( 'fs');\n  const headers = {\n    'Content-Type': 'application/json',\n    'Authorization': `Bearer ${token}`,\n  };\n\n  //Get full URL for plugin update API\n  //Plugin update API uses a non-standard API prefix (OK, but why?)\n  const pluginApiUrl = (endpoint) => `${appUrl(`/api/plugins${endpoint}`)}`;\n\n  //Get the plugin machine json file for a saved plugin\n  async function getPluginMachineJson(pluginId){\n    return fetch(\n      apiUrl(`/plugins/${pluginId}/code`),\n      {\n        method: 'GET',\n        headers,\n      }\n    ).catch( e => {\n      error(`Error getting plugin machine json for plugin ${pluginId}`);\n      console.log(e);\n    }).then( r => r.json() ).then(r => {\n      return r;\n    })\n  }\n\n  return {\n    getPluginMachineJson,\n    //Add a feature to a plugin\n    addFeature: async (pluginMachineJson,data)  =>{\n      const {pluginId,buildId}=pluginMachineJson;\n      return fetch(\n        apiUrl(`/plugins/${pluginId}/builds/${buildId}/features`),\n        {\n          method: \"POST\",\n          body: JSON.stringify(data),\n          headers,\n        }\n      )\n      .catch( e => {\n        error(`Error adding feature to plugin ${pluginId}`);\n        console.log(e);\n      }).then( r => r.json())\n        .then(r => {\n          return {\n            files: r.files,\n            featureId:r.setting.id,\n            main: r.main ? r.main : false,\n          };\n        });\n\n\n    },\n    //Get one file, from a feature\n    getFeatureCode: async (pluginMachineJson,featureId,file) => {\n      const {pluginId,buildId}=pluginMachineJson;\n      return fetch(\n        apiUrl(`/plugins/${pluginId}/builds/${buildId}/features/${featureId}/code?file=${encodeURI(file)}`),\n        {\n          method: \"GET\",\n        headers,        }\n      ).catch( e => {\n        error(`Error getting feature ${featureId} for plugin ${pluginId}`);\n        console.log(e);\n      }).then( r => r.text() ).then(r => {\n        return r;\n      });\n    },\n    //upoad a new version\n    uploadVersion: async (pluginMachineJson,version) => {\n      const url = \"https://minor.pluginmachine.dev/api/plugins/1/versions\";\n      const {pluginId,slug} = pluginMachineJson;\n      const fileName = `${slug}.zip`;\n\n      let formdata = new FormData();\n      formdata.append(\"zip\", fileName, \"/C:/Users/jpoll/Downloads/arms.zip\");\n      formdata.append(\"version\", version);\n\n      let requestOptions = {\n        method: 'POST',\n        headers: {\n          \"Authorization\": `Bearer ${token}`,\n          //If\n          \"Content-Type\": \"multipart/form-data\",\n        },\n        body: formdata,\n        redirect: 'follow'\n      };\n\n    return fetch(url, {\n      method: 'POST',\n      headers: {\n        \"Authorization\": `Bearer ${token}`,\n        //With this for Content-Type, I get:\n        // {\"error\":{\"zip\":[\"The zip field is required.\"]}}\n        // If I remove this, I get: {\"error\":{\"zip\":[\"The zip must be a file of type: zip.\"]}}\n       \"Content-Type\": \"multipart/form-data\",\n      },\n      body: formdata,\n      redirect: 'follow'\n    })\n      .then(response => response.text())\n      .then(r => {\n        switch(r.status){\n          case 400:\n            return r.json().then(r => {\n              error(`Error uploading a ${version} update for plugin ${pluginId}`);\n              console.log(r.error);\n            });\n          case 401:\n            console.log(headers);\n            info(token);\n            error(`Error uploading a ${version} update for plugin ${pluginId}`);\n            throw new Error(r.statusText || 'Unauthorized');\n          case 201:\n          case 200:\n            try {\n              return r.json();\n            } catch (error) {\n              console.log({r,error});\n              throw error;\n            }\n          default:\n            console.log(r);\n            throw new Error(r.statusText || 'Unknown error');\n        }\n\n\n        throw new  Error(`Error uploading version ${version} for plugin ${pluginId}`);\n      })\n      .catch(error => console.log('error', error));\n\n\n    },\n    //upoad a new version\n    getVersions: async (pluginMachineJson) => {\n      const {pluginId}=pluginMachineJson;\n\n      return fetch(\n        pluginApiUrl(`/${pluginId}/versions`),\n        {\n          method: \"GET\",\n          headers,\n        }\n      ).catch( e => {\n        error(`Error getting versions for plugin ${pluginId}`);\n        console.log(e);\n      }).then( r => r.json() ).then(r => {\n          return r;\n      });\n    },\n    //Write a file, with some saftery features\n    writeFile: async(pluginDir,file,fileContents) => {\n      //Has a path?\n      let split = file.split('/');\n      //Create directories if they don't exist\n      if( split.length > 1 ) {\n        let createDir = pluginDir;\n        for (let i = 0; i < split.length -1; i++) {\n          createDir = `${createDir}/${split[i]}`;\n          if( ! fs.existsSync(createDir) ) {\n            fs.mkdirSync(createDir);\n          }\n        }\n\n      }\n\n      fs.writeFileSync(`${pluginDir}/${file}`,fileContents,{ flag: 'w+' });\n    },\n\n  };\n\n}\n\n\n\nfunction parseArgumentsIntoOptions(rawArgs) {\n//https://www.npmjs.com/package/arg\n  const args = arg(\n    {\n      '--pluginId': String,\n      '--feature': String,\n      '--pluginDir': String,\n      '--appUrl': String,\n      // Aliases\n    },\n    {\n      argv: rawArgs.slice(2),\n    }\n  );\n  return {\n    command: args._[1] || false,\n    feature: args['--feature'] || false,\n    pluginId: args['--pluginId'] || args._[2] || false,\n    pluginDir: args['--pluginDir'] || false,\n    appUrl: args['--appUrl'] || false,\n\n  };\n}\nasync function promptForFeature(options,features) {\n  const questions = [];\n\n  const hasFeature = (rule) => {\n    return features.hasOwnProperty(rule);\n  }\n  const getFeatureChoices = () => {\n    return Object.keys(features).map(feature => {\n      return {\n        name: features[feature].feature.singular,\n        value: feature,\n      }\n    });\n  }\n\n  if( 'string' !== typeof options.feature || !hasFeature(options.feature) ) {\n    questions.push({\n      type: 'list',\n      name: 'feature',\n      message: 'What type of feature would you like to add?',\n      choices:getFeatureChoices(),\n    });\n    options = await promptForMissingOptions(options,questions);\n  }\n\n  return options;\n}\n\nasync function promptForZipOptions(options) {\n  const questions = [{\n    type: 'list',\n    name: 'version',\n    message: 'Would you like to create a new release?',\n    choices:[\n      {\n        name: 'NO',\n        value: false,\n      },\n      {\n        value: 'patch',\n        name: 'Yes, a patch release',\n      },\n      {\n        name: 'Yes, a minor release',\n        value: 'minor',\n      },\n      {\n        name: 'Yes, a major release',\n        value: 'release',\n      },\n    ]\n  }];\n\n  options = await promptForMissingOptions(options,questions);\n\n\n  return options;\n}\n\nasync function promptForFeatureRules(options,allRules) {\n  const {feature} = options;\n  const questions = [];\n  if( ! allRules.hasOwnProperty(feature) ) {\n    throw new Error(`Feature ${feature} not found`);\n    return;\n  }\n  Object.keys(allRules[feature]).forEach(rule => {\n    const {label,options,rules} = allRules[feature][rule];\n\n    if( null !== options ) {\n        questions.push({\n          type: 'list',\n          name: rule,\n          message: label,\n          choices:Object.keys(options).map(option => {\n            return {\n              value:options[option],\n              name:option,\n            }\n          }),\n        });\n    }else if( 'string' === rules[0] ) {\n      questions.push({\n        type: 'prompt',\n        name: rule,\n        message: label,\n      });\n    }\n  });\n\n  options = await promptForMissingOptions(options,questions);\n\n  return options;\n}\n\nasync function promptForMissingOptions(options,questions) {\n  if( questions.length ) {\n    const answers = await inquirer.prompt(questions);\n    options= Object.assign(options, answers);\n  }\n  return options;\n}\n\n/**\n * Hander for `plugin-machine plugin config` command\n */\nasync function handleConfig(pluginDir,pluginId,pluginMachine) {\n  const fs = require('fs');\n  let newPluginMachineJson = await pluginMachine.getPluginMachineJson(pluginId);\n  fs.writeFileSync(`${pluginDir}/pluginMachine.json`, JSON.stringify(newPluginMachineJson, null, 2));\n  return true;\n}\n\n/**\n * Hander for `plugin-machine plugin zip` command\n */\nasync function handleZip(pluginDir,pluginMachineJson){\n  const {makeZip} = require('./zip');\n  await makeZip(pluginDir,pluginMachineJson);\n}\n\n/**\n * Hander for `plugin-machine plugin add` command\n */\nasync function handleAddFeature(pluginDir,pluginMachine,pluginMachineJson,options){\n  const {feature} = options;\n  const data = {};\n  const badKeys = ['command','feature','pluginId'];\n  Object.keys(options).forEach( option => {\n    if( -1 == badKeys.indexOf(option) ) {\n      if( 'string' === typeof options[option] ) {\n        data[option] = options[option].toLowerCase();\n      }\n    }\n  });\n  data.featureType = feature;\n\n  let {featureId,files,main} = await pluginMachine.addFeature(pluginMachineJson,data).catch(e => {\n      throw new Error(e);\n  });\n  info( `Saved new ${feature} feature with id ${featureId}`);\n\n  const promises = [];\n  if( files.length ){\n    files.forEach(async(file) => {\n      let fileContents = await pluginMachine.getFeatureCode(pluginMachineJson,featureId,file);\n      promises.push(\n        await pluginMachine.writeFile(pluginDir,file,fileContents).catch(e => {\n            throw new Error(e);\n        }).then(() => {\n          info(`Added ${file}`);\n        })\n      )});\n  }\n\n  const outputMain = async () => {\n    if( main && main.length ){\n      important( 'IMPORTANT!')\n      important( 'You must add this to the main file of your plugin:')\n      if( Array.isArray(main)){\n        main.forEach(main => {\n          important( main);\n        });\n      }else if( 'string' === typeof main ){\n        important( main );\n      }\n    }\n  }\n  Promise.all(promises).then(outputMain);\n\n}\n\n//Make sure we have a token\nconst checkLogin = (token) => {\n  if( ! token ) {\n    throw new Error('No token found, you must be logged in to use this command');\n  }\n  return token;\n}\n\nconst validatePluginJson = (pluginMachineJson) => {\n  if( ! pluginMachineJson.pluginId ) {\n    throw new Error('No pluginId found in pluginMachine.json');\n  }\n  if( ! pluginMachineJson.buildId ) {\n    throw new Error('No buildId found in pluginMachine.json');\n  }\n  return pluginMachineJson;\n}\n\n/**\n * Hander for `plugin-machine plugin {command}` commands\n */\nexport async function cli(args) {\n  let options = parseArgumentsIntoOptions(args);\n  const pluginDir = options.pluginDir || getPluginDir();\n  let pluginMachineJson = getPluginMachineJson(pluginDir,{\n    //Allow app/api URL to be overridden from --appUrl flag\n    appUrl:options.appUrl,\n  });\n  const pluginMachine = await pluginMachineApi(\n    checkLogin(options.token || getAuthToken(pluginDir)),\n  );\n  console.log({options});\n  return;\n\n  switch (options.command) {\n    case 'config':\n      await handleConfig(\n        pluginDir,\n        options.pluginId || pluginMachineJson.pluginId,\n        pluginMachine\n      );\n      break;\n    case 'zip':\n      pluginMachineJson = validatePluginJson(pluginMachineJson);\n      options = await promptForZipOptions(options);\n      await handleZip(pluginDir,pluginMachineJson);\n      if( options.version){\n        try {\n          await pluginMachine.uploadVersion(pluginMachineJson,options.version);\n        } catch (error) {\n            console.log(error);\n\n        }\n      }\n      break;\n    case 'add':\n      pluginMachineJson = validatePluginJson(pluginMachineJson);\n      const rules = require( './data/rules.json');\n      const features = require( './data/features.json');\n      options = await promptForFeature(options,features);\n      options = await promptForFeatureRules(options,rules);\n      await handleAddFeature(\n        pluginDir,pluginMachine,pluginMachineJson,options\n      );\n      break;\n    default:\n      throw new Error(`Command plugin ${options.command} not found`);\n      break;\n  }\n\n}\n"],"names":["cli","arg","require","inquirer","getAuthToken","getPluginDir","getPluginMachineJson","appUrl","apiUrl","error","important","info","pluginMachineApi","token","FormData","fetch","fs","headers","pluginApiUrl","endpoint","pluginId","method","catch","e","console","log","then","r","json","addFeature","pluginMachineJson","data","buildId","body","JSON","stringify","files","featureId","setting","id","main","getFeatureCode","file","encodeURI","text","uploadVersion","version","url","slug","fileName","formdata","append","requestOptions","redirect","response","status","Error","statusText","getVersions","writeFile","pluginDir","fileContents","split","length","createDir","i","existsSync","mkdirSync","writeFileSync","flag","parseArgumentsIntoOptions","rawArgs","args","String","argv","slice","command","_","feature","promptForFeature","options","features","questions","hasFeature","rule","hasOwnProperty","getFeatureChoices","Object","keys","map","name","singular","value","push","type","message","choices","promptForMissingOptions","promptForZipOptions","promptForFeatureRules","allRules","forEach","label","rules","option","answers","prompt","assign","handleConfig","pluginMachine","newPluginMachineJson","handleZip","makeZip","handleAddFeature","badKeys","indexOf","toLowerCase","featureType","promises","outputMain","Array","isArray","Promise","all","checkLogin","validatePluginJson"],"mappings":"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"}